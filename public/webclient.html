<!DOCTYPE HTML>
<html>
<head>
    <meta http-equiv="content-type" content="text/html"/>
    <meta name="author" content="https://www.baidu.com"/>
    <meta charset="UTF-8">
    <title>webSocket</title>
    <script>
        var socket;

        function connect() {
            try {
                socket = new WebSocket("ws://127.0.0.1:9501");
            } catch (e) {
                alert('ws connect error');
            }

            socket.onopen = sOpen;
            socket.onerror = sError;
            socket.onmessage = sMessage;
            socket.onclose = sClose;
        }

        function child(element, content, parent) {
            var child_div = document.createElement(element);
            var date = new Date();
            child_div.innerHTML = date.toLocaleString().split('/').join('-') + "<br>" + content + "<br>";
            child_div.style.textAlign = 'left';
            child_div.style.fontSize = '3px';
            child_div.id = 'chat_message';
            parent.appendChild(child_div);
        }

        function sOpen() {
            child('div', '系统消息: connect success!', document.getElementById('message'));
        }

        function sError(e) {
            alert('error ' + e);
        }

        function sClose(e) {
            child('div', 'connect close: ' + e.code, document.getElementById('message'))
        }

        function sMessage(msg) {
            var data = JSON.parse(msg.data);
            // console.log(data);
            var length = document.getElementById('message').children.length;
            if (length > 16) {
                document.getElementById('chat_message').remove();
            }
            if (data.error_reason) {
                child('div', data.msg_type + ":" + data.error_reason, document.getElementById('message'));
            }
        }

        function Send() {
            if (socket) {
                socket.send(document.getElementById("msg").value);
            } else {
                alert("websocket disconnected!");
            }
        }

        function Close() {
            if (socket) {
                socket.close();
            } else {
                alert("websocket disconnected!");
            }
        }

    </script>
</head>
<body>
<div style="float: left;">
    <div style="text-align: center; margin-bottom: 5px;">
        <button id="connect" onclick="connect();">Connect</button>
        <button id="close" onclick="Close();">Close</button>
    </div>
    <textarea id="msg" style="width: 150px;height: 100px;"></textarea>
    <div style="text-align: center">
        <button class="btn btn-primary" id="send" onclick="Send();" style="margin-top: 5px;">Send</button>
    </div>
</div>
<div style="width: 500px; height: 620px; border: 1px solid; text-align: center; float: left; margin-left: 20px;">
    <div style="text-align: center; border-bottom: 1px solid; background-color: #afd9ee"> 消息框</div>
    <div id="message" style="background-color: whitesmoke; margin-top: 10px;"></div>
</div>
</body>
</html>